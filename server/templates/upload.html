<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="static/Captured-removebg-preview.png" type="image/x-icon">
    <title>Upload Image - Pulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900 font-sans">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="text-2xl font-bold text-blue-600">Pulse</div>
            </div>
            <div class="space-x-6">
                <a href="#" class="hover:text-blue-600 transition">Features</a>
                <a href="#" class="hover:text-blue-600 transition">Pricing</a>
                <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Upload Image Section -->
    <div class="container mx-auto px-4 py-16 grid md:grid-cols-2 gap-12 items-center">
        <!-- Upload Form Section -->
        <div class="bg-white p-10 rounded-xl shadow-2xl">
            <h2 class="text-4xl font-bold mb-6 text-gray-900">Upload Medical Image</h2>
            <p class="text-xl text-gray-600 mb-8">
                Upload your medical scan for AI-powered analysis and reporting.
            </p>
            
            <form id="upload-form">
                <div>
                    <label for="patient-name">Patient Name</label>
                    <input 
                        type="text" 
                        id="patient-name" 
                        name="patient_name" 
                        placeholder="Enter patient name"
                    >
                </div>
        
                <div>
                    <label for="file-input">Upload Scan</label>
                    <input 
                        type="file" 
                        id="file-input" 
                        name="file" 
                        accept=".png,.jpg,.jpeg,.dcm,.dicom"
                    >
                </div>
        
                <div>
                    <label for="scan-type">Scan Type</label>
                    <select id="scan-type" name="scan_type">
                        <option value="">Select Scan Type</option>
                        <option value="brain">X-Ray</option>
                        <option value="bone">MRI</option>
                        <option value="brain">CT Scan</option>
                        <option value="bone">Ultrasound</option>
                    </select>
                </div>
        
                <div id="image-preview" class="border-2 border-dashed border-gray-300 rounded-lg h-80 flex items-center justify-center">
                    No image uploaded
                </div>
        
                <div class="grid grid-cols-2 gap-4">
                    <button 
                        type="button" 
                        id="generate-report" 
                        class="bg-blue-600 text-white py-2 rounded"
                    >
                        Generate Report
                    </button>
                    <button 
                        type="button" 
                        id="download-report" 
                        class="bg-green-600 text-white py-2 rounded" 
                        disabled
                    >
                        Download Report
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Image Preview and Benefits Section -->
        <div class="space-y-8">
            <div class="bg-gray-50 p-6 rounded-xl">
                <h3 class="text-xl font-semibold mb-4 text-gray-900">Image Preview</h3>
                <div class="border-2 border-dashed border-gray-300 rounded-lg h-80 flex items-center justify-center">
                    <p class="text-gray-500">No image uploaded</p>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl flex items-start space-x-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                <div>
                    <h3 class="text-xl font-semibold mb-2">AI-Powered Analysis</h3>
                    <p class="text-gray-600">Advanced machine learning provides detailed, accurate insights.</p>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 rounded-xl flex items-start space-x-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Comprehensive Reporting</h3>
                    <p class="text-gray-600">Detailed medical reports with AI-assisted analysis and insights.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="container mx-auto px-4 grid md:grid-cols-4 gap-8">
            <div>
                <div class="text-2xl font-bold text-blue-500 mb-4">Pulse</div>
                <p class="text-gray-400">AI-Powered Radiology Assistance</p>
            </div>
            <div>
                <h4 class="font-semibold mb-4">Product</h4>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-300 hover:text-white">Features</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">Pricing</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">Integrations</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-semibold mb-4">Company</h4>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-300 hover:text-white">About</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">Careers</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">Contact</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-semibold mb-4">Legal</h4>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-300 hover:text-white">Privacy Policy</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">Terms of Service</a></li>
                    <li><a href="#" class="text-gray-300 hover:text-white">HIPAA Compliance</a></li>
                </ul>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const uploadForm = document.getElementById('upload-form');
    const fileInput = document.getElementById('file-input');
    const patientNameInput = document.getElementById('patient-name');
    const scanTypeSelect = document.getElementById('scan-type');
    const imagePreview = document.getElementById('image-preview');
    const generateReportBtn = document.getElementById('generate-report');
    const downloadReportBtn = document.getElementById('download-report');

    let uploadedFile = null;
    let diagnosticResults = null;

    // File upload and preview
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            uploadedFile = file;
            
            // Image preview
            const reader = new FileReader();
            reader.onload = (event) => {
                imagePreview.innerHTML = `<img src="${event.target.result}" class="max-h-full max-w-full object-contain">`;
            };
            reader.readAsDataURL(file);
        }
    });

    // AI Analysis and Report Generation
    generateReportBtn.addEventListener('click', async () => {
        if (!uploadedFile) {
            alert('Please upload an image first');
            return;
        }

        const formData = new FormData();
        formData.append('file', uploadedFile);
        formData.append('modality', scanTypeSelect.value);

        try {
            // First, analyze the image
            const analysisResponse = await fetch('/analyze/image', {
                method: 'POST',
                body: formData
            });

            if (!analysisResponse.ok) {
                throw new Error('Image analysis failed');
            }

            const analysisResult = await analysisResponse.json();
            diagnosticResults = analysisResult;

            // Then generate the report
            const reportResponse = await fetch('/generate-report', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify({
                    findings: analysisResult.findings.map(f => `${f.condition}: ${f.probability}`),
                    patient_info: {
                        'Patient Name': patientNameInput.value || 'Unknown',
                        'Scan Type': scanTypeSelect.value
                    }
                })
            });

            if (!reportResponse.ok) {
                throw new Error('Report generation failed');
            }

            const reportResult = await reportResponse.json();

            // Enable download button and potentially display report
            downloadReportBtn.disabled = false;
            downloadReportBtn.addEventListener('click', () => {
                const blob = new Blob([reportResult.raw_report], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `medical_report_${new Date().toISOString()}.txt`;
                a.click();
                window.URL.revokeObjectURL(url);
            });

        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred during image analysis or report generation');
        }
    });
});
    </script>

<script>
    // Logout functionality
    document.getElementById('logout-btn').addEventListener('click', function() {
        // Remove access token from localStorage
        localStorage.removeItem('access_token');
        
        // Redirect to login page
        window.location.href = '/login';
    });

    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            // If no token exists, redirect to login
            window.location.href = '/login';
        }
    });
</script>
</body>
</html>